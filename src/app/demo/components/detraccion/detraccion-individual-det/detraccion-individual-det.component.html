<div class="container">
      <p-panel header="Detraccion masiva prespuesto detalle" class="mb-3">
        <p-breadcrumb [model]="items" class="max-w-full"></p-breadcrumb>
    </p-panel>
    </div>
    <br/>
    <div class="card p-2">
            <!-- First row with 2 elements -->
        <div style="display: flex; width: 100%; margin-bottom: 1rem;">
            <div style="margin-right: 20px; flex: 1;">
                <label for="username" class="text-sm">Pago Nro: </label>
                <input pInputText id="username" aria-describedby="username-help"
                 [value]="pagnro" [disabled]="true"
                    style="width: 100%; height: 2.5rem;" />
            </div>

            <div style="flex: 1;">
                <label for="fecha" class="text-sm">Fecha: </label>
                <input id="fecha" [value]="fechaString" 
                [disabled]="true" style="width: 100%; height: 2.5rem;" />
                <!-- <p-calendar [disabled]="true" [(ngModel)]="fecha" style="width: 100%; height: 2.5rem;"
                    inputStyleClass="p-input-sm" dateFormat="dd/mm/yy"></p-calendar> -->
            </div>

            

        </div>

         <div style="display: flex; width: 100%; margin-bottom: 1rem;">
            <div style="margin-right: 20px; flex: 1;">
                <label for="motivo" class="text-sm">Motivo: </label>
                <input pInputText id="motivo" aria-describedby="motivo-help" [value]="motivo" [disabled]="true"
                    style="width: 100%; height: 2.5rem;" />
            </div>

            <div style="flex: 1;">
                <label for="medio-pago" class="text-sm">Medio Pago: </label>
                <input pInputText id="medio-pago" aria-describedby="medio-pago-help" [value]="medio"
                    [disabled]="true" style="width: 100%; height: 2.5rem;" />
            </div>
      </div>


      <div class="card p-2">
        <p-table [value]="DetallePago" sortField="ban02Ruc" sortMode="single" rowGroupMode="subheader"
            groupRowsBy="ban02Ruc" [scrollable]="true" scrollHeight="500px" [loading]="load"
            [globalFilterFields]="['ban02Ruc','razonsocial','ban02NroDoc']">
            <ng-template pTemplate="header">
                <tr>
                    <th rowspan="2">Item</th>
                    <th rowspan="2">RUC
                        <br>
                        <br>
                        <p-columnFilter type="text" field="ban02Ruc" placeholder="Buscar" ariaLabel="RUC"
                            [showMenu]="false" matchMode="contains"></p-columnFilter>
                    </th>
                    <th rowspan="2">Razon Social
                        <br>
                        <br>
                        <p-columnFilter type="text" field="razonsocial" placeholder="Buscar" ariaLabel="Razon Social"
                            [showMenu]="false" matchMode="contains"></p-columnFilter>
                    </th>
                    <th rowspan="2">Tipo Doc</th>
                    <th rowspan="2">Numero
                        <br>
                        <br>
                        <p-columnFilter type="text" field="ban02NroDoc" placeholder="Buscar" ariaLabel="Nro Documento"
                            [showMenu]="false" matchMode="contains"></p-columnFilter>
                    </th>
                    <th rowspan="2">Moneda Original</th>
                    <th rowspan="2" style="display: none;">Fecha emision</th>
                    <th rowspan="2"style="display: none;">Fecha vencimiento</th>
                    <th rowspan="2" style="display: none;">Importe Total S/.</th>
                    <th rowspan="2"style="display: none;">Importe Total US$</th>
                    <th colspan="2"></th>
                    <th colspan="3"  >Detraccion</th>
                    <th colspan="1" style="display: none;">Retencion</th>
                    <th colspan="1" style="display: none;">Percepcion</th>
                    <th colspan="2" style="display: none;">Neto a Pagar</th>
                    <th colspan="4" style="display: none;"></th>
                </tr>
                <tr>
                    <th colspan="1" style="white-space: pre-wrap;" >Comprobante<br>ImpDoc.S/.</th>
                    <th colspan="1" style="white-space: pre-wrap;">comprobante<br>ImpDoc$</th>

                    <th colspan="1">Tipo</th>
                    <th colspan="1">Tasa</th>
                    <th colspan="1">Importe</th>

                    <th colspan="1" style="display: none;"></th>
                    <th colspan="1" style="display: none;"></th>
                    <th colspan="1" style="display: none;">S/.</th>
                    <th colspan="1" style="display: none;">US$</th>
                    <!-- <th colspan="1">Acciones</th> -->
                </tr>
            </ng-template>

            <ng-template pTemplate="groupheader" let-groupData>
                <tr pRowGroupHeader>
                    <!--
                    <td colspan="8">
                        <div class="flex items-center gap-2">
                            <span class="font-bold">{{ groupData.ban02Proveedor }}</span>
                        </div>
                    </td>-->
                </tr>
            </ng-template>

            <!-- <ng-template pTemplate="groupfooter" let-groupData>
                <tr>
                    <td colspan="8">
                    </td>
                    <td class="font-bold pr-12" style="text-align: right;">{{ calculateGroupTotal(groupData.ban02Ruc, 'ban02Soles') |
                        number:'1.2-2' }}</td>
                    <td class="font-bold pr-12" style="text-align: right;">{{ calculateGroupTotal(groupData.ban02Ruc, 'ban02Dolares') |
                        number:'1.2-2' }}</td>

                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td class="font-bold pr-12" style="text-align: right;">{{ calculateGroupTotal(groupData.ban02Ruc,
                        'importeDetraccion') |
                        number:'1.2-2' }}</td>
                    <td class="font-bold pr-12" style="text-align: right;">{{ calculateGroupTotal(groupData.ban02Ruc,
                        'ban02ImporteRetencionSoles') |
                        number:'1.2-2' }}</td>
                    <td class="font-bold pr-12" style="text-align: right;">{{ calculateGroupTotal(groupData.ban02Ruc,
                        'ban02ImportePercepcionSoles') |
                        number:'1.2-2' }}</td>
                    <td class="font-bold pr-12" style="text-align: right;">{{ calculateGroupTotal(groupData.ban02Ruc, 'ban02NetoSoles') |
                        number:'1.2-2' }}</td>
                    <td class="font-bold pr-12" style="text-align: right;">{{ calculateGroupTotal(groupData.ban02Ruc, 'ban02NetoDolares') |
                        number:'1.2-2' }}</td>
                </tr>
            </ng-template> -->

            <ng-template pTemplate="body" let-detalle>
                <tr>
                    <td style="text-align: left;">{{ detalle.item }}</td>
                    <td style="text-align: left;">{{ detalle.ban02Ruc }}</td>
                    <td style="text-align: left;">{{ detalle.razonsocial }}</td>
                    <td style="text-align: left;">{{ detalle.nombreTipoDocumento }}</td>
                    <td style="text-align: left;">{{ detalle.ban02NroDoc }}</td>
                    <td
                        [ngClass]="{'soles-class': detalle.nombremoneda === 'SOLES',
                         'dolares-class': detalle.nombremoneda === 'DOLARES'}" style="text-align: left; ">
                        {{ detalle.nombremoneda }}</td>
                    <td style="text-align: left; display: none;">{{detalle.ban02FechaEmision}}</td>
                    <td style="text-align: left; display: none;">{{detalle.ban02FechaVencimiento}}</td>
                    <td [ngClass]="{'soles-classs': detalle.nombremoneda === 'SOLES'}" 
                    style="text-align: right; display: none;">{{ detalle.ban02Soles |
                        number:'1.2-2' }}</td>

                    <td [ngClass]="{'dolares-classs': detalle.nombremoneda === 'DOLARES'}" 
                    style="text-align: right; display: none;">{{ detalle.ban02Dolares |
                        number:'1.2-2' }}</td>

                    <td style="text-align: right;">
                        <ng-container *ngIf="editingRow?.item === detalle.item; else viewMode">
                            <input pInputText type="number" [(ngModel)]="editingRow.importecomprobantesoles"
                                [disabled]="!esEditablePagoSoles" (change)="calcularNetoPago(detalle,'S')" />
                        </ng-container>
                        <ng-template #viewMode><span
                                [style.font-weight]="detalle.nombremoneda === 'SOLES' ? 'bold' : 'normal'">
                                {{ detalle.importecomprobantesoles | number:'1.2-2' }}
                            </span></ng-template>
                    </td>
                    <td style="text-align: right;">
                        <ng-container *ngIf="editingRow?.item === detalle.item; else viewModeDolares">
                            <input pInputText type="number" [(ngModel)]="editingRow.importecomprobantedolares"
                                [disabled]="!esEditablePagoDolares" (change)="calcularNetoPago(detalle,'D')" />
                        </ng-container>
                        <ng-template #viewModeDolares><span
                                [style.font-weight]="detalle.nombremoneda === 'DOLARES' ? 'bold' : 'normal'">
                                {{ detalle.importecomprobantedolares | number:'1.2-2' }}
                            </span></ng-template>
                    </td>

                    <td style="text-align: right;">
                        <ng-container *ngIf="editingRow?.item === detalle.item; else viewModeTipoDetraccion">
                            <input pInputText type="text" [(ngModel)]="editingRow.ban02TipoDetraccion" />
                        </ng-container>
                        <ng-template #viewModeTipoDetraccion>{{ detalle.ban02TipoDetraccion }}</ng-template>
                    </td>

                    <td style="text-align: left;">
                        <ng-container *ngIf="editingRow?.item === detalle.item; else viewModeTasaDetraccion">
                            <input pInputText type="number" [(ngModel)]="editingRow.ban02Tasadetraccion" />
                        </ng-container>
                        <ng-template #viewModeTasaDetraccion>{{ detalle.ban02Tasadetraccion }}</ng-template>
                    </td>

                    <td style="text-align: right;">
                        <ng-container *ngIf="editingRow?.item === detalle.item; else viewModeImporteDetraccion">
                            <input pInputText type="number" [(ngModel)]="editingRow.importeDetraccion"
                                (change)="calcularNetoPago(editingRow)" />
                        </ng-container>
                        <ng-template #viewModeImporteDetraccion>{{ detalle.importeDetraccion     | number:'1.2-2'
                            }}</ng-template>
                    </td>

                    <td style="text-align: right; display: none;">
                        <ng-container *ngIf="editingRow?.item === detalle.item; else viewModeImporteRetencion">
                            <input pInputText type="number" [(ngModel)]="editingRow.ban02ImporteRetencionSoles" />
                        </ng-container>
                        <ng-template #viewModeImporteRetencion>{{ detalle.ban02ImporteRetencionSoles | number:'1.2-2'
                            }}</ng-template>
                    </td>
                    <td style="text-align: right; display: none;">
                        <ng-container *ngIf="editingRow?.item === detalle.item; else viewModeImportePercepcion">
                            <input pInputText type="number" [(ngModel)]="editingRow.ban02ImportePercepcionSoles" />
                        </ng-container>
                        <ng-template #viewModeImportePercepcion>{{ detalle.ban02ImportePercepcionSoles | number:'1.2-2'
                            }}</ng-template>
                    </td>

                    <td style="text-align: right; display: none;">{{ detalle.ban02NetoSoles | number:'1.2-2' }}</td>
                    <td style="text-align: right; display: none;">{{ detalle.ban02NetoDolares | number:'1.2-2' }}</td>
                   
                </tr>
            </ng-template>

            <ng-template pTemplate="footer">
    <tr style="background-color: #e9ecef; font-weight: bold; border-top: 2px solid #000;">
        <td colspan="6" style="text-align: right; padding: 8px;">SUMAS:</td>
        <td style="display: none;"></td>
        <td style="display: none;"></td>
        <td style="display: none;"></td>
        <td style="display: none;"></td>
        <td class="font-bold" style="text-align: right; padding: 8px;">
            {{ calculateTotal('importecomprobantesoles') | number:'1.2-2' }}
        </td>
        <td class="font-bold" style="text-align: right; padding: 8px;">
            {{ calculateTotal('importecomprobantedolares') | number:'1.2-2' }}
        </td>
        <td style="text-align: center; padding: 8px;"></td>
        <td style="text-align: center; padding: 8px;"></td>
        <td class="font-bold" style="text-align: right; padding: 8px;">
            {{ calculateTotal('importeDetraccion') | number:'1.2-2' }}
        </td>
        <td style="text-align: right; display: none;">
            {{ calculateTotal('ban02ImporteRetencionSoles') | number:'1.2-2' }}
        </td>
        <td style="text-align: right; display: none;">
            {{ calculateTotal('ban02ImportePercepcionSoles') | number:'1.2-2' }}
        </td>
        <td style="text-align: right; display: none;">
            {{ calculateTotal('ban02NetoSoles') | number:'1.2-2' }}
        </td>
        <td style="text-align: right; display: none;">
            {{ calculateTotal('ban02NetoDolares') | number:'1.2-2' }}
        </td>
    </tr>
</ng-template>
           
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="19" style="text-align: center; font-weight: bold; padding: 1rem;">
                        No se encontraron registros
                    </td>
                </tr>
            </ng-template>


        </p-table>
    </div>


  </div>