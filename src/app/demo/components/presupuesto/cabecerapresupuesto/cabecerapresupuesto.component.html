<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>
<div class="container">
    <p-panel header="Lista de Pagos" class="mb-3">
        <p-breadcrumb [model]="items" class="max-w-full;"></p-breadcrumb>
        <br>
        <p-button label="Nuevo" icon="pi pi-plus" (onClick)="iniciarNuevoPresupuesto()" [disabled]="mostrarNuevaFila"/>
    </p-panel>
    <br>
    <div class="card p-2">
        <p-table [value]="presupuesto"  [scrollable]="true" scrollHeight="400px"
            [scrollDirection]="'both'" [loading]="loading" [globalFilterFields]="['pagoNumero']">

            <ng-template pTemplate="header">
                <tr>
                    <th rowspan="2">Pago Nro
                        <br>
                        <br>
                        <p-columnFilter type="text" field="pagoNumero" placeholder="Buscar"
                            ariaLabel="Pago Nro" [showMenu]="false" ></p-columnFilter>
                    </th>
                    <th rowspan="2">Fecha</th>
                    <th rowspan="2">Motivo</th>
                    <th rowspan="2">Medio Pago</th>
                    <th colspan="2" class="text-center">Bruto a Pagar</th>
                    <th colspan="3" class="text-center">Afectos</th>
                    <th colspan="2" class="text-center">Neto a Pagar</th>
                    <th colspan="5"></th>
                </tr>
                <tr>
                    <th colspan="1">S/.</th>
                    <th colspan="1">US$</th>
                    <th colspan="1">Detracción</th>
                    <th colspan="1">Retención</th>
                    <th colspan="1">Percepción</th>
                    <th colspan="1">S/.</th>
                    <th colspan="1">US$</th>
                    <th colspan="1">Estado</th>
                    <th colspan="1">Fecha Ejecución Pago</th>
                    <th colspan="1">nro Operacion</th>
                    <th colspan="1">Adjuntar / Ver Comprobante pago</th>
                    <th colspan="1">Acciones</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-presupuesto>
                <tr>
                    <td>{{presupuesto.pagoNumero}}</td>
                    <td>{{ presupuesto.fecha | date:'dd/MM/yyyy' }}</td>
                    <td>{{presupuesto.motivo}}</td>
                    <td>{{presupuesto.mediopago}}</td>
                    <td>{{presupuesto.impBrutoSoles | number:'1.2-2'}}</td>
                    <td>{{presupuesto.impBrutoDolares | number:'1.2-2'}}</td>
                    <td>{{presupuesto.impDetraccionSoles| number:'1.2-2'}}</td>
                    <td>{{presupuesto.impRetencionSoles| number:'1.2-2'}}</td>
                    <td>{{presupuesto.impPercepcionSoles| number:'1.2-2'}}</td>
                    <td>{{presupuesto.netoPagaSoles | number:'1.2-2'}}</td>
                    <td>{{presupuesto.netoPagoDolares | number:'1.2-2'}}</td>
                    <td>{{presupuesto.estado}}</td>
                    <td></td>
                    <td></td>
                    <td>{{presupuesto.enlaceComprobante}}</td>
                    <td>
                        <div class="flex gap-2">
                            <p-button icon="pi pi-eye" styleClass="p-button-info p-button-sm" pTooltip="Ver Detalles"
                                [text]="true" (onClick)="verDetalles(presupuesto)" [disabled]="botonesDeshabilitados"></p-button>
                            <p-button icon="pi pi-pencil" styleClass="p-button-info p-button-sm" pTooltip="Modificar"
                                [text]="true" (onClick)="modificarPago(presupuesto)" [disabled]="botonesDeshabilitados"></p-button>
                            <p-button icon="pi pi-trash" styleClass="p-button-danger p-button-sm" pTooltip="Eliminar"
                                [text]="true" (onClick)="eliminarPago(presupuesto)" [disabled]="botonesDeshabilitados"></p-button>
                            <p-button icon="pi pi-check" styleClass="p-button-success p-button-sm"
                                pTooltip="Confirmar Pago" [text]="true"
                                (onClick)="confirmarPago(presupuesto)" [disabled]="botonesDeshabilitados"></p-button>
                            <p-button icon="pi pi-ban" styleClass="p-button-danger p-button-sm"
                                (onClick)="anularPago(presupuesto)" [text]="true" pTooltip="Anular pago" [disabled]="botonesDeshabilitados"></p-button>
                        </div>
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="footer">
                <tr *ngIf="mostrarNuevaFila">
                    <td style="min-width: 100px;">
                        <input pInputText
                               [(ngModel)]="nuevoPresupuesto.ban01Numero"
                               placeholder="Número"
                               class="w-full">
                    </td>
                    <td style="min-width: 130px;">
                        <p-calendar [(ngModel)]="nuevoPresupuesto.ban01Fecha"
                                   dateFormat="dd/mm/yy"
                                   placeholder="Fecha"
                                   (onSelect)="actualizarFecha($event)"
                                   [showIcon]="true"
                                   appendTo="body"
                                   class="w-full"></p-calendar>
                    </td>
                    <td style="min-width: 150px;">
                        <input pInputText
                               [(ngModel)]="nuevoPresupuesto.ban01Descripcion"
                               placeholder="Descripción"
                               class="w-full">
                    </td>
                    <td style="min-width: 80px;">
                        <input pInputText
                               [(ngModel)]="nuevoPresupuesto.ban01Anio"
                               placeholder="Año"
                               class="w-full">
                    </td>
                    <td style="min-width: 80px;">
                        <input pInputText
                               [(ngModel)]="nuevoPresupuesto.ban01Mes"
                               placeholder="Mes"
                               class="w-full">
                    </td>
                    <td style="min-width: 100px;">
                        <input pInputText
                               [(ngModel)]="nuevoPresupuesto.ban01Pc"
                               placeholder="PC"
                               class="w-full">
                    </td>
                    <td style="min-width: 150px;">
                        <input pInputText
                               [(ngModel)]="nuevoPresupuesto.ban01FechaRegistro"
                               [readonly]="true"
                               class="w-full">
                    </td>
                    <td colspan="5"></td>
                    <td>
                        <div class="flex gap-2">
                            <p-button icon="pi pi-save"
                                     styleClass="p-button-success p-button-sm"
                                     [text]="true"
                                     (onClick)="guardarNuevoPresupuesto()"
                                     pTooltip="Guardar"></p-button>
                            <p-button icon="pi pi-times"
                                     styleClass="p-button-danger p-button-sm"
                                     [text]="true"
                                     (onClick)="cancelarNuevo()"
                                     pTooltip="Cancelar"></p-button>
                        </div>
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="16" style="text-align: center; font-weight: bold; padding: 1rem;">
                        No se encontraron registros
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>
