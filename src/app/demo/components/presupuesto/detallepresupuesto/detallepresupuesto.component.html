<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>
<div class="container">
    <p-panel header="Lista de Pagos" class="mb-3">
        <p-breadcrumb [model]="items" class="max-w-full;"></p-breadcrumb>
    </p-panel>
    <br>
    <div class="card p-2">
        <!-- Fila 1: Username y botones -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
            <div>
                <label for="username" class="text-sm">Pago Nro: </label>
                <input pInputText id="username" aria-describedby="username-help" [value]="pagnro" [disabled]="true"
                    [style]="{'min-width': '200px', 'max-width': '100%', 'height': '2.5rem'}" />
            </div>
            <div>
                <p-button label="Grabar" icon="pi pi-save" styleClass="p-button-sm mr-2"></p-button>
                <p-button label="Cancelar" icon="pi pi-ban" styleClass="p-button-sm"></p-button>
            </div>
        </div>

        <!-- Fila 2: Fecha y botones -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
            <div>
                <label for="fecha" class="text-sm">Fecha: </label>
                <p-calendar [disabled]="true" [(ngModel)]="fecha"
                    [style]="{'min-width': '200px', 'max-width': '100%', 'height': '2.5rem'}"
                    inputStyleClass="p-input-sm" dateFormat="dd/mm/yy"></p-calendar>
            </div>
            <div>
                <p-button label="Reporte para pago" icon="pi pi-file-pdf" styleClass="p-button-sm mr-2"></p-button>
                <p-button label="Genera Archivo para pago" icon="pi pi-file-export" styleClass="p-button-sm"></p-button>
            </div>
        </div>

        <!-- Fila 3: Motivo -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
            <div>
                <label for="motivo" class="text-sm">Motivo: </label>
                <input pInputText id="motivo" aria-describedby="motivo-help" [value]="motivo" [disabled]="true"
                    [style]="{'min-width': '200px', 'max-width': '100%', 'height': '2.5rem'}" />
            </div>
        </div>

        <!-- Fila 4: Medio de Pago y botÃ³n -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
            <div>
                <label for="medio-pago" class="text-sm">Medio Pago: </label>
                <input pInputText id="medio-pago" aria-describedby="medio-pago-help" [value]="medio" [disabled]="true"
                    [style]="{'min-width': '200px', 'max-width': '100%', 'height': '2.5rem'}" />
            </div>
            <div style="display: flex; justify-content: flex-end;">
                <p-button label="Agregar Doc x Pagar" icon="pi pi-plus" styleClass="p-button-sm" [routerLink]="'/Home/nuevo-presupuesto'"></p-button>
            </div>
        </div>
    </div>
    <div class="card p-2">
        <p-table [value]="DetallePago" sortField="ban02Proveedor" sortMode="single" rowGroupMode="subheader"
            groupRowsBy="ban02Proveedor" [scrollable]="true" scrollHeight="500px" [loading]="load">
            <ng-template pTemplate="header">
                <tr>
                    <th rowspan="2">Item</th>
                    <th rowspan="2">RUC</th>
                    <th rowspan="2">Razon Social</th>
                    <th rowspan="2">Tipo Doc</th>
                    <th rowspan="2">Numero</th>
                    <th rowspan="2">Moneda Original</th>
                    <th rowspan="2">Importe Total S/.</th>
                    <th rowspan="2">Importe Total US$</th>
                    <th colspan="2"></th>
                    <th colspan="3">Detraccion</th>
                    <th colspan="1">Retencion</th>
                    <th colspan="1">Percepcion</th>
                    <th colspan="2">Neto a Pagar</th>
                    <th colspan="4"></th>
                </tr>
                <tr>
                    <th colspan="1">Monto a Pagar S/.</th>
                    <th colspan="1">Monto a Pagar $</th>
                    <th colspan="1">Tipo</th>
                    <th colspan="1">Tasa</th>
                    <th colspan="1">Importe</th>
                    <th colspan="1"></th>
                    <th colspan="1"></th>
                    <th colspan="1">S/.</th>
                    <th colspan="1">US$</th>
                    <th colspan="1">Acciones</th>
                </tr>
            </ng-template>

            <ng-template pTemplate="groupheader" let-groupData>
                <tr pRowGroupHeader>
                    <!--
                    <td colspan="8">
                        <div class="flex items-center gap-2">
                            <span class="font-bold">{{ groupData.ban02Proveedor }}</span>
                        </div>
                    </td>-->
                </tr>
            </ng-template>

            <ng-template pTemplate="groupfooter" let-groupData>
                <tr>
                    <td colspan="6">
                    </td>
                    <td class="font-bold pr-12">{{ calculateGroupTotal(groupData.ban02Proveedor, 'ban02Soles') |
                        number:'1.2-2' }}</td>
                    <td class="font-bold pr-12">{{ calculateGroupTotal(groupData.ban02Proveedor, 'ban02Dolares') |
                        number:'1.2-2' }}</td>

                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td class="font-bold pr-12">{{ calculateGroupTotal(groupData.ban02Proveedor, 'ban02ImporteSolesDet') |
                        number:'1.2-2' }}</td>
                    <td></td>
                    <td class="font-bold pr-12">{{ calculateGroupTotal(groupData.ban02Proveedor, 'ban02ImporteSolesPercepcion') |
                        number:'1.2-2' }}</td>
                    <td class="font-bold pr-12">{{ calculateGroupTotal(groupData.ban02Proveedor, 'netoSoles') |
                        number:'1.2-2' }}</td>
                    <td class="font-bold pr-12">{{ calculateGroupTotal(groupData.ban02Proveedor, 'netoDolares') |
                        number:'1.2-2' }}</td>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-detalle>
                <tr>
                    <td>{{ detalle.item }}</td>
                    <td>{{ detalle.ban02Ruc }}</td>
                    <td>{{ detalle.ban02Proveedor }}</td>
                    <td>{{ detalle.ban02Tipodoc }}</td>
                    <td>{{ detalle.ban02NroDoc }}</td>
                    <td>{{ detalle.ban02Moneda }}</td>
                    <td>{{ detalle.ban02Soles | number:'1.2-2' }}</td>
                    <td>{{ detalle.ban02Dolares | number:'1.2-2' }}</td>
                    <td>{{ detalle.ban02PagoSoles | number:'1.2-2' }}</td>
                    <td>{{ detalle.ban02PagoDolares | number:'1.2-2' }}</td>
                    <td>{{ detalle.tipoDetraccion }}</td>
                    <td>{{ detalle.ban02TasaDet }}</td>
                    <td>{{ detalle.ban02ImporteSolesDet | number:'1.2-2' }}</td>
                    <td> </td>
                    <td>{{ detalle.ban02ImporteSolesPercepcion | number:'1.2-2' }}</td>
                    <td>{{ detalle.netoSoles | number:'1.2-2' }}</td>
                    <td>{{ detalle.netoDolares | number:'1.2-2' }}</td>
                    <td>
                        <p-button icon="pi pi-trash" styleClass="p-button-danger p-button-sm" pTooltip="Eliminar"
                            [text]="true" (onClick)="eliminarPago(presupuesto)"></p-button>
                        <p-button icon="pi pi-pencil" styleClass="p-button-warning p-button-sm" pTooltip="Modificar"
                            [text]="true" (onClick)="modificarPago(presupuesto)"></p-button>
                        <p-button icon="pi pi-times" styleClass="p-button-danger p-button-sm" pTooltip="Cancelar"
                            [text]="true" (onClick)="modificarPago(presupuesto)"></p-button>
                        <p-button icon="pi pi-save" styleClass="p-button-info p-button-sm" pTooltip="Grabar"
                            [text]="true" (onClick)="verDetalles(presupuesto)"></p-button>
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="footer">
                <tr>
                    <td colspan="5" class="text-right font-bold"></td>
                    <td class="font-bold">Sumas</td>
                    <td class="font-bold">{{ getTotalColumn('ban02Soles') | number:'1.2-2' }}</td>
                    <td class="font-bold">{{ getTotalColumn('ban02Dolares') | number:'1.2-2' }}</td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td class="font-bold">{{ getTotalColumn('ban02ImporteSolesDet') | number:'1.2-2' }}</td>
                    <td class="font-bold">{{ getTotalColumn('retencion') | number:'1.2-2' }}</td>
                    <td class="font-bold">{{ getTotalColumn('ban02ImporteSolesPercepcion') | number:'1.2-2' }}</td>
                    <td class="font-bold">{{ getTotalColumn('netoSoles') | number:'1.2-2' }}</td>
                    <td class="font-bold">{{ getTotalColumn('netoDolares') | number:'1.2-2' }}</td>
                    <td></td>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="14" style="text-align: center; font-weight: bold; padding: 1rem;">
                        No se encontraron registros
                    </td>
                </tr>
            </ng-template>


        </p-table>
    </div>

</div>
